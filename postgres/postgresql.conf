# PostgreSQL Configuration - Optimized for Low-Memory VPS (512MB)
# =============================================================================
# This configuration is tuned for a very small server (512MB RAM)
# Adjust values based on your actual server specifications

# Connection Settings
listen_addresses = '*'
port = 5432
max_connections = 20

# Memory Settings
# ---------------
# shared_buffers: 25% of total RAM (128MB for 512MB server)
shared_buffers = 64MB

# effective_cache_size: Total memory available for disk caching
effective_cache_size = 128MB

# work_mem: Memory for each sort/hash operation
work_mem = 2MB

# maintenance_work_mem: Memory for maintenance operations
maintenance_work_mem = 32MB

# Write Ahead Log (WAL) Settings
# ------------------------------
# wal_buffers: Buffer size for WAL
wal_buffers = 4MB

# checkpoint_completion_target: Spread checkpoint completion
checkpoint_completion_target = 0.9

# max_wal_size: Maximum size of WAL before checkpoint
max_wal_size = 256MB

# min_wal_size: Minimum size of WAL to retain
min_wal_size = 32MB

# Query Planner Settings
# ----------------------
# random_page_cost: Cost of non-sequential disk access
# Lower for SSDs (1.1), higher for HDDs (4.0)
random_page_cost = 1.1

# effective_io_concurrency: Number of concurrent I/O operations
effective_io_concurrency = 50

# default_statistics_target: Detail level for planner statistics
default_statistics_target = 100

# Parallel Query Settings
# -----------------------
max_worker_processes = 4
max_parallel_workers_per_gather = 2
max_parallel_workers = 4
max_parallel_maintenance_workers = 2

# Logging Settings
# ----------------
log_destination = 'stderr'
logging_collector = on
log_directory = 'pg_log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_rotation_age = 1d
log_rotation_size = 100MB
log_min_duration_statement = 1000  # Log queries taking more than 1 second
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on
log_temp_files = 0

# Auto-vacuum Settings
# --------------------
# More aggressive auto-vacuum for better performance
autovacuum = on
autovacuum_max_workers = 3
autovacuum_naptime = 1min
autovacuum_vacuum_threshold = 50
autovacuum_analyze_threshold = 50
autovacuum_vacuum_scale_factor = 0.02
autovacuum_analyze_scale_factor = 0.01

# Connection Security
# -------------------
ssl = off  # Will be handled by Nginx
password_encryption = scram-sha-256

# Locale Settings
lc_messages = 'en_US.UTF-8'
lc_monetary = 'en_US.UTF-8'
lc_numeric = 'en_US.UTF-8'
lc_time = 'en_US.UTF-8'

# Default timezone
timezone = 'UTC'
